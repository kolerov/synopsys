
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>WSL &#8212; Kolerov&#39;s Notes 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tasks" href="../tasks/index.html" />
    <link rel="prev" title="Linux" href="linux.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../tasks/index.html" title="Tasks"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="linux.html" title="Linux"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Kolerov&#39;s Notes 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Environment</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">WSL</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="wsl">
<h1>WSL<a class="headerlink" href="#wsl" title="Permalink to this heading">¶</a></h1>
<section id="install-ubuntu">
<h2>Install Ubuntu<a class="headerlink" href="#install-ubuntu" title="Permalink to this heading">¶</a></h2>
<p>Install the latest Ubuntu:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>wsl --install -d Ubuntu
wsl --set-default-version 2
</pre></div>
</div>
<p>For restricting consumption of memory create <code class="docutils literal notranslate"><span class="pre">.wslconfig</span></code> in User’s directory:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[wsl2]</span>
<span class="n">memory</span><span class="o">=</span><span class="mi">8</span><span class="n">GB</span>
</pre></div>
</div>
</section>
<section id="install-wsl-vpnkit">
<h2>Install <code class="docutils literal notranslate"><span class="pre">wsl-vpnkit</span></code><a class="headerlink" href="#install-wsl-vpnkit" title="Permalink to this heading">¶</a></h2>
<p>Install wsl-vpnkit to avoid problems related to corporate VPN. This tool may
be found in <a class="reference external" href="https://github.com/sakai135/wsl-vpnkit">https://github.com/sakai135/wsl-vpnkit</a>. Download the prebuilt
file <code class="docutils literal notranslate"><span class="pre">wsl-vpnkit.tar.gz</span></code> from the latest release and import the distro into
WSL 2. Running the distro will show a short intro and exit.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>wsl --import wsl-vpnkit --version 2 $env:USERPROFILE\wsl-vpnkit wsl-vpnkit.tar.gz
wsl -d wsl-vpnkit
</pre></div>
</div>
<p>Add the command to your <code class="docutils literal notranslate"><span class="pre">.profile</span></code> or <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> to start <code class="docutils literal notranslate"><span class="pre">wsl-vpnkit</span></code>
when you open your WSL terminal.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>wsl.exe -d wsl-vpnkit --cd /app service wsl-vpnkit start
</pre></div>
</div>
</section>
<section id="configure-dns-resolving-for-vpn">
<h2>Configure DNS resolving for VPN<a class="headerlink" href="#configure-dns-resolving-for-vpn" title="Permalink to this heading">¶</a></h2>
<p>Create <code class="docutils literal notranslate"><span class="pre">/etc/wsl.conf</span></code>:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[network]</span>
<span class="n">generateResolvConf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
</pre></div>
</div>
<p>Reboot WSL and create <code class="docutils literal notranslate"><span class="pre">/etc/resolv.conf</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>nameserver 10.228.0.1
nameserver 10.228.0.2
search internal.synopsys.com
nameserver 1.1.1.1
</pre></div>
</div>
</section>
<section id="shrink-virtual-disk-s-space">
<h2>Shrink virtual disk’s space<a class="headerlink" href="#shrink-virtual-disk-s-space" title="Permalink to this heading">¶</a></h2>
<p>Shrink virtual disk’s space when it’s necessary. Follow instructions
from <a class="reference external" href="https://stephenreescarter.net/how-to-shrink-a-wsl2-virtual-disk/">https://stephenreescarter.net/how-to-shrink-a-wsl2-virtual-disk/</a>.
Example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>PS C:\Users\ykolerov&gt; wsl --terminate Ubuntu
PS C:\Users\ykolerov&gt; diskpart

Microsoft DiskPart version 10.0.19041.964

Copyright (C) Microsoft Corporation.
On computer: SNPS-RDN8FHBSCC

DISKPART&gt; select vdisk file=&quot;C:\Users\ykolerov\AppData\Local\Packages\CanonicalGroupLimited.Ubuntu20.04onWindows_79rhkp1fndgsc\LocalState\ext4.vhdx&quot;

DiskPart successfully selected the virtual disk file.

DISKPART&gt; compact vdisk

100 percent completed

DiskPart successfully compacted the virtual disk file.
</pre></div>
</div>
<p>Sometimes it’s better to reboot laptop before doing those steps so you
can be sure that a virtual disk is note used.</p>
</section>
<section id="build-and-install-a-custom-kernel">
<h2>Build and install a custom kernel<a class="headerlink" href="#build-and-install-a-custom-kernel" title="Permalink to this heading">¶</a></h2>
<p>In Ubuntu/WSL:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>flex<span class="w"> </span>bison<span class="w"> </span>libssl-dev<span class="w"> </span>libelf-dev<span class="w"> </span>git<span class="w"> </span>dwarves<span class="w"> </span>bc
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/microsoft/WSL2-Linux-Kernel.git
<span class="nb">cd</span><span class="w"> </span>WSL2-Linux-Kernel
cp<span class="w"> </span>Microsoft/config-wsl<span class="w"> </span>.config
make<span class="w"> </span>-j<span class="w"> </span><span class="k">$(</span>expr<span class="w"> </span><span class="k">$(</span>nproc<span class="k">)</span><span class="w"> </span>-<span class="w"> </span><span class="m">1</span><span class="k">)</span>
cp<span class="w"> </span>arch/x86/boot/bzImage<span class="w"> </span>/mnt/c/Users/ykolerov/bzImage
</pre></div>
</div>
<p>Create the file <code class="docutils literal notranslate"><span class="pre">%userprofile%\.wslconfig</span></code> that contains:</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[wsl2]</span>
<span class="n">kernel</span><span class="o">=</span><span class="s">&quot;C:\\Users\\ykolerov\\bzImage&quot;</span>
</pre></div>
</div>
<p>In PowerShell, run <code class="docutils literal notranslate"><span class="pre">wsl</span> <span class="pre">--shutdown</span></code>. Details mey be found here:
<a class="reference external" href="https://unix.stackexchange.com/questions/594470/wsl-2-does-not-have-lib-modules">https://unix.stackexchange.com/questions/594470/wsl-2-does-not-have-lib-modules</a>.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">WSL</a><ul>
<li><a class="reference internal" href="#install-ubuntu">Install Ubuntu</a></li>
<li><a class="reference internal" href="#install-wsl-vpnkit">Install <code class="docutils literal notranslate"><span class="pre">wsl-vpnkit</span></code></a></li>
<li><a class="reference internal" href="#configure-dns-resolving-for-vpn">Configure DNS resolving for VPN</a></li>
<li><a class="reference internal" href="#shrink-virtual-disk-s-space">Shrink virtual disk’s space</a></li>
<li><a class="reference internal" href="#build-and-install-a-custom-kernel">Build and install a custom kernel</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="linux.html"
                          title="previous chapter">Linux</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../tasks/index.html"
                          title="next chapter">Tasks</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/environment/wsl.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../tasks/index.html" title="Tasks"
             >next</a> |</li>
        <li class="right" >
          <a href="linux.html" title="Linux"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Kolerov&#39;s Notes 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Environment</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">WSL</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Yuriy Kolerov.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>